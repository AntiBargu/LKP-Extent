setenv serverip 192.168.31.78
setenv ipaddr 192.168.31.111
setenv kernel_load_address 0x2080000
setenv devicetree_load_address 0x2000000
setenv kernel_size 0x500000
setenv devicetree_size 0x20000
setenv squash rootfs.squashfs
setenv squashstart 0x1f20000
setenv squashsize 0x8000000
setenv load_squash "tftpboot ${clobstart} ${squash}"
setenv install_squash "nand erase ${squashstart} ${squashsize} && nand write ${clobstart} ${squashstart} ${squashsize}"
setenv update_squash "setenv img squash; setenv psize ${squashsize}; setenv installcmd "install_squash"; run load_squash test_img; setenv img; setenv psize; setenv installcmd"
setenv userdata userdata.jffs2
setenv userdatastart 0x9f20000
setenv userdatasize 0x1000000
setenv load_userdata "tftpboot ${clobstart} ${userdata}"
setenv install_userdata "nand erase ${userdatastart} ${userdatasize} && nand write ${clobstart} ${userdatastart} ${userdatasize}"
setenv update_userdata "setenv img "userdata"; setenv psize ${userdatasize}; setenv installcmd "install_userdata"; run load_squash test_img; setenv img; setenv psize; setenv installcmd"
setenv nandboot "nand read ${kernel_load_address} ${kernelstart} ${kernel_size} && nand read ${devicetree_load_address} ${dtbstart} ${devicetree_size} && bootm ${kernel_load_address} - ${devicetree_load_address}"
setenv default_bootcmd "run nandboot"
saveenv

手敲
run update_dtb
run update_kernel
run update_squash
run load_userdata
run install_userdata
nand erase ${userdatastart} 0x360e0000

boot
之后改init.sh即可 

tftp目录
D:\Study\WangLab\Files\pro\njuradio2_firmware\njuradio_zl\Debug

reset sys
ifconfig eth0 192.168.31.113 && cd /home/wisecom/ &&tftp -g -r init.sh  192.168.31.78 && tftp -g -r njuradio.ko 192.168.31.78 && tftp -g -r rf_init 192.168.31.78 && mkdir .local && cd .local && mkdir bin && cd bin && tftp -g -r tx_regain.sh 192.168.31.78 && tftp -g -r rx_gain.sh 192.168.31.78 && tftp -g -r remote 192.168.31.78 && tftp -g -r command.py 192.168.31.78  && tftp -g -r speedTest.py 192.168.31.78  &&  tftp -g -r device.sh 192.168.31.78  &&  chmod u+x ./* && cd ../.. && chmod u+x ./* 
ifconfig eth0 192.168.31.113 && cd /home/wisecom/ &&tftp -g -r init.sh  192.168.31.78 && tftp -g -r njuradio.ko 192.168.31.78 && tftp -g -r rf_init 192.168.31.78 && mkdir .local && cd .local && mkdir bin && cd bin && tftp -g -r tx_regain.sh 192.168.31.78 && tftp -g -r rx_gain.sh 192.168.31.78 && tftp -g -r remote 192.168.31.78  &&  tftp -g -r device.sh 192.168.31.78  &&  chmod u+x ./* && cd ../.. && chmod u+x ./* 
vi init.sh
./init.sh

master:
D:\Study\WangLab\Files\njuradio2_firmware-develop\njuradio2_firmware-develop\njuradio_zl\Debug
cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko&& tftp -g -r njuradio_zl.elf -l njuradio.elf 192.168.31.78 && ./rf_init && tx_regain.sh 0 && rx_gain.sh 44 && remote start
发送端:
cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=114&& tftp -g -r njuradio_zl.elf -l njuradio.elf 192.168.31.78 && ./rf_init && tx_regain.sh 0 && rx_gain.sh 44 && remote start&&ifconfig vnet0 192.168.123.114
接收端：
cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=115&& tftp -g -r njuradio_zl.elf -l njuradio.elf 192.168.31.78 && ./rf_init && tx_regain.sh 0 && rx_gain.sh 44 && remote start&&ifconfig vnet0 192.168.123.115



develop分支划出的tryToMerge
114-115：
    114：
    cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=114 nextip=115&& tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.114&&tftp -g -r main 192.168.31.78&&chmod 777 *
    115：
    cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=115 nextip=114&& tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.115&&tftp -g -r main 192.168.31.78&&chmod 777 *

ip是物理地址的最后一个字节
   101：
    cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=101 && tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.101&&tftp -g -r main 192.168.31.78&&chmod 777 *
   102：
    cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=102 && tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.102&&tftp -g -r main 192.168.31.78&&chmod 777 *
   103:
    cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=103 && tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.103 &&tftp -g -r main 192.168.31.78&&chmod 777 *
    nohup:
    nohup ./main 0 > 1.out &
    nohup ./main 1 > 2.out &
    nohup ./main 2 > 3.out &

83592017

tftp -g -r route 192.168.31.78&&chmod 777 * && ./route -A inet add -net 192.168.123.0 netmask 255.255.255.0 dev vnet0

网关决定下一跳，手动输入本节点IP：
	114:
	cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=114 && tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.114&&tftp -g -r route 192.168.31.78&&chmod 777 * && ./route -A inet add -host 192.168.123.116 netmask 255.255.255.0 gateway 192.168.123.115  dev vnet0

	115：
	cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=115 && tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.115&&tftp -g -r route 192.168.31.78&&chmod 777 * && ./route -A inet add -host 192.168.123.116 netmask 255.255.255.0 dev vnet0&& ./route -A inet add -host 192.168.123.114 netmask 255.255.255.0 dev vnet0

	116:
	cd /home/wisecom/ && tftp -g -r vnet_device.ko 192.168.31.78 && insmod vnet_device.ko ip=116 && tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.116&&tftp -g -r route 192.168.31.78&&chmod 777 * && ./route -A inet add -host 192.168.123.114 netmask 255.255.255.0 gateway 192.168.123.115  dev vnet0


net_drive:
发送端114:
cd /home/wisecom/ && tftp -g -r net_driver.ko 192.168.31.78 && insmod net_driver.ko ip=114&& tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.114

接收端115：
cd /home/wisecom/ && tftp -g -r net_driver.ko 192.168.31.78 && insmod net_driver.ko ip=115&& tftp -g -r njuradio2.elf -l njuradio.elf 192.168.31.78 && ./rf_init && rx_gain.sh 44&& tx_regain.sh -30  && remote start&&ifconfig vnet0 192.168.123.115


origin:
D:\Study\WangLab\Files\njuradio2_firmware-develop\njuradio2_firmware-develop\njuradio_zl\Debug
cd /home/wisecom/ && tftp -g -r vnet_device_origin.ko   -l vnet_device.ko 192.168.31.78 && insmod vnet_device.ko&& tftp -g -r njuradio_zl.elf -l njuradio.elf 192.168.31.78 && ./rf_init && tx_regain.sh 0 && rx_gain.sh 44 && remote start


打印驱动：
echo 7 > /proc/sys/kernel/printk
打印物理层中断：
echo 10001 > /sys/class/njuradio/njuradio/device/command

修改路由表:
114：
	tftp -g -r route 192.168.31.78&&chmod 777 * && ./route -A inet add -host 192.168.123.116 netmask 255.255.255.0 gateway 192.168.123.115  dev vnet0
115：
	tftp -g -r route 192.168.31.78&&chmod 777 * && ./route -A inet add -host 192.168.123.116 netmask 255.255.255.0 dev vnet0
	tftp -g -r route 192.168.31.78&&chmod 777 * && ./route -A inet add -host 192.168.123.114 netmask 255.255.255.0 dev vnet0
116：
	tftp -g -r route 192.168.31.78&&chmod 777 * && ./route -A inet add -host 192.168.123.114 netmask 255.255.255.0 gateway 192.168.123.115  dev vnet0
内核和用户通信：
tftp -g -r kernelDemo.ko 192.168.31.78 && insmod kernelDemo.ko&&tftp -g -r user 192.168.31.78&&chmod 777 *
nohup ./user > print.out &



change ip:
ifconfig vnet0 192.168.123.
114发，115收，需要在insmod vnet_device.ko ip=115时，ip写最后地址的一位，例如115写5
ping 192.168.123.115
ping 192.168.123.116
ping -c 1 192.168.123.115



phy test
tftp目录换成
D:\Study\WangLab\Files\pro\tftp
cd /home/wisecom/ && tftp -g -r njuradio.ko 192.168.31.78 && insmod njuradio.ko debug=0 net_hdr=1 && tftp -g -r njuradio2_phy.elf -l njuradio.elf 192.168.31.78 &&tftp -g -r bb_init 192.168.31.78&& chmod 777 *&&./bb_init && tx_regain.sh -30 && remote start

send:
echo 2 > /sys/class/njuradio/njuradio/device/device_id
receive:
echo 1 > /sys/class/njuradio/njuradio/device/device_id

等待测试2个节点互ping的合并新版本
D:\Study\WangLab\Files\pro\to_merge\njuradio2_firmware\njuradio_zl\Debug



7035:

内核：下载2019_R1之后，make menuconfig，load 20220505.config,save .config，make prepare，make scripts 


开关全拨到1，密码是nju，先串口，再ssh



驱动出bug问康正
192.168.31.104:9212
开机：先运行init.sh，再ssh，elf; .ko; main 文件放入/root目录
/root/init.sh &&   ifconfig eth0 down && ifconfig eth0 up && cd /root/
 ifconfig eth0 down && ifconfig eth0 up
 ifconfig vnet0 down && ifconfig vnet0  up


   101：
    /root/init.sh &&   ifconfig eth0 down && ifconfig eth0 up && cd /root/  &&  cd /root &&insmod  vnet_device.ko ip=101 mtu=2500  outIP=103&&  /root/mac_start.sh manual 22 njuphy.elf 5 101&&  ifconfig vnet0 192.168.123.101  &&  chmod 777 *&& echo 1 >/proc/sys/net/ipv4/ip_forward && echo 4 > /proc/sys/kernel/printk 
   102：
    /root/init.sh &&   ifconfig eth0 down && ifconfig eth0 up && cd /root/  &&  cd /root &&insmod  vnet_device.ko ip=102 mtu=2500  outIP=103&&  /root/mac_start.sh manual 22 njuphy.elf 5 102&&  ifconfig vnet0 192.168.123.102  &&  chmod 777 *&&echo 1 >/proc/sys/net/ipv4/ip_forward && echo 4 > /proc/sys/kernel/printk
   103:
    /root/init.sh &&   ifconfig eth0 down && ifconfig eth0 up && cd /root/  &&  cd /root &&insmod vnet_device.ko ip=103 mtu=2500  outIP=103&&  /root/mac_start.sh manual 22 njuphy.elf 5 103&&  ifconfig vnet0 192.168.123.103&&chmod 777 *&&echo 1 >/proc/sys/net/ipv4/ip_forward && echo 4 > /proc/sys/kernel/printk 
   104：
    /root/init.sh &&   ifconfig eth0 down && ifconfig eth0 up && cd /root/  &&  cd /root &&insmod  vnet_device.ko ip=104 mtu=2500  outIP=103&&  /root/mac_start.sh manual 22 njuphy.elf 5 104 &&  ifconfig vnet0 192.168.123.104  &&  chmod 777 * && echo 1 >/proc/sys/net/ipv4/ip_forward && echo 4 > /proc/sys/kernel/printk
   105：
    /root/init.sh &&   ifconfig eth0 down && ifconfig eth0 up && cd /root/  &&  cd /root &&insmod vnet_device.ko ip=105 mtu=2500 outIP=103&&  /root/mac_start.sh manual 22 njuphy.elf 5 105 &&  ifconfig vnet0 192.168.123.105  &&  chmod 777 *&&echo 1 >/proc/sys/net/ipv4/ip_forward && echo 4 > /proc/sys/kernel/printk

   ./mac_start_gqy.sh manual 22 njuphy.elf 5 1
   ./mac_start_gqy.sh manual 22 njuphy.elf 5 2

   echo 10001 > /sys/class/njuradio/njuradio/device/command

   echo 8 > /proc/sys/kernel/printk

   ifconfig vnet0 mtu 2500

   dmesg -c

    nohup:
    nohup ./main 0 > 1.out &
    nohup ./main 1 > 2.out &
    nohup ./main 2 > 3.out &
    nohup ./main 3 > 4.out &
    nohup ./main 4 > 5.out &
    
    ./main 2 104 > 3.out &
    ./main 3 103 105 > 4.out & 
    ./main 4 104 > 5.out &


./tcpRecving 105 2048 9999
./tcpSending 105 2048 9999

ping -s 2048 -i 0.05 192.168.123.105

TCP:
iperf3 -s
iperf3 -i 1 -t 9999 -c  192.168.123.105

TCP双向：
105:
iperf3 -s -p 5200 &
104:
iperf3 -s -p 5300 &
105:
iperf3 -i 1 -t 40 -c  192.168.123.104 -p 5300 &
104:
iperf3 -i 1 -t 40 -c  192.168.123.105 -p 5200 &

UDP:	
iperf3  -s -i 1
iperf3 -u -b 10M -t 60 -i 1 -t 9999  -c 192.168.123.105
iperf3 -u -b 8M 